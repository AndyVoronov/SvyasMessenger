# Техническое задание на разработку кроссплатформенного мобильного приложения-мессенджера

## 1. Введение

### 1.1. Краткое описание проекта
Проект представляет собой разработку кроссплатформенного мобильного приложения-мессенджера, предназначенного для обмена текстовыми сообщениями, файлами, а также проведения голосовых и видеозвонков в реальном времени. Приложение должно работать на платформах iOS (версии 14.0 и выше) и Android (версии 10.0 и выше), обеспечивая единый пользовательский опыт. Основной фокус — на безопасном, быстром и удобном общении между пользователями, с поддержкой индивидуальных и групповых чатов.

### 1.2. Цели проекта
- Создать надежный инструмент для повседневного общения, конкурирующий с существующими мессенджерами (например, WhatsApp, Telegram).
- Обеспечить высокую безопасность данных пользователей, включая шифрование сообщений end-to-end.
- Достичь кроссплатформенной совместимости для минимизации затрат на разработку и поддержку.
- Интегрировать функции реального времени для повышения вовлеченности пользователей.
- Достичь минимального времени отклика интерфейса (менее 200 мс на основные действия) и поддержки до 1 млн активных пользователей в перспективе.

### 1.3. Целевая аудитория
- Пользователи в возрасте 18–45 лет, активно использующие мобильные устройства для общения (студенты, офисные работники, фрилансеры).
- Корпоративные пользователи для внутренних коммуникаций (малый и средний бизнес).
- Географически: глобальная аудитория с фокусом на русскоязычные страны (Россия, СНГ), с поддержкой многоязычности (русский, английский как минимум).
- Уровень технической грамотности: средний и выше, с ожиданием интуитивного интерфейса для новичков.

## 2. Технический стек

### 2.1. Frontend
- Фреймворк: React Native (версия 0.73 или выше) для обеспечения кроссплатформенности.
- Язык программирования: TypeScript для строгой типизации и снижения ошибок.
- Библиотеки: 
  - React Navigation для навигации между экранами.
  - Redux или MobX для управления состоянием приложения.
  - Socket.io-client для реального времени (чатов и звонков).
  - React Native WebRTC для голосовых и видеозвонков.
- Хостинг: Фронтенд должен быть размещен на Vercel для веб-версии приложения (PWA — Progressive Web App), обеспечивая доступ через браузер как дополнение к мобильным версиям. Мобильные сборки развертываются через App Store и Google Play.

### 2.2. Backend и БД
- Backend: Supabase (как BaaS — Backend as a Service), включая аутентификацию, реальное время и хранение файлов.
- База данных: PostgreSQL (встроенная в Supabase), с использованием Row Level Security (RLS) для контроля доступа.
- Язык для кастомных функций: JavaScript/TypeScript (Edge Functions в Supabase).
- Интеграции: Supabase Realtime для подписки на изменения в БД (для чатов и уведомлений).

### 2.3. Дополнительные инструменты
- CI/CD: GitHub Actions для автоматизированной сборки и тестирования.
- Тестирование: Jest для unit-тестов, Detox для E2E-тестов на мобильных устройствах.
- Мониторинг: Sentry для отслеживания ошибок и производительности.

## 3. Функциональные требования

Функциональные требования разделены по модулям. Каждый модуль описывает ключевые сценарии использования, входные/выходные данные и логику работы.

### 3.1. Модуль аутентификации и профиля
- **Аутентификация**:
  - Регистрация: Пользователь вводит email, пароль (минимум 8 символов, с требованиями к сложности) и подтверждает по OTP (one-time password), отправляемому на email. Альтернатива: регистрация через Google/Apple ID.
  - Вход: Логин по email/паролю или OAuth. Поддержка биометрии (Face ID/Touch ID) для повторного входа.
  - Восстановление пароля: Запрос на email с ссылкой для сброса.
  - Сценарий: При успешной регистрации/входе пользователь перенаправляется на главный экран чатов. Ошибки: отображение сообщений (например, "Неверный пароль").
- **Профиль**:
  - Редактирование: Изменение аватара (загрузка фото до 5 МБ, форматы JPG/PNG), имени, статуса (текст до 100 символов), номера телефона (для поиска контактов).
  - Просмотр: Отображение профиля другого пользователя (имя, аватар, статус, дата последнего онлайн).
  - Конфиденциальность: Настройки видимости (кто видит онлайн-статус: все/контакты/никто).
  - Сценарий: Пользователь нажимает на аватар в меню — открывается экран профиля с полями для редактирования. Сохранение изменений обновляет данные в БД Supabase.

### 3.2. Модуль чатов и сообщений
- **Чаты**:
  - Создание: Индивидуальный чат (по поиску пользователя по имени/email/номеру) или групповой (до 100 участников, с назначением админа).
  - Список чатов: Отображение в хронологическом порядке (последние сообщения сверху), с индикацией непрочитанных (бейдж с числом).
  - Архивация/удаление: Долгое нажатие на чат — опции архива/удаления.
- **Сообщения**:
  - Отправка: Текст (до 2000 символов), эмодзи, файлы (фото/видео до 50 МБ, документы до 100 МБ), голосовые сообщения (запись до 5 мин).
  - Получение: Реальное время через Supabase Realtime — автоматическое обновление чата при новом сообщении.
  - Функции: Редактирование/удаление сообщений (в течение 15 мин после отправки), цитирование, реакции (эмодзи на сообщение).
  - Шифрование: End-to-end с использованием Signal Protocol (библиотека libsignal).
  - Сценарий: В чате пользователь вводит текст и нажимает "Отправить" — сообщение сохраняется в БД, шифруется и отображается у получателя в реальном времени. Если оффлайн — доставка при подключении.

### 3.3. Модуль голосовых и видеозвонков
- **Голосовые звонки**:
  - Инициация: Из чата — кнопка "Звонок". Поддержка индивидуальных и групповых (до 8 участников).
  - Функции: Вкл/выкл микрофон, громкая связь, запись звонка (с согласием всех участников, хранение в Supabase Storage).
  - Завершение: Автоматическое при потере соединения или ручное.
- **Видеозвонки**:
  - Инициация: Кнопка "Видеозвонок" в чате.
  - Функции: Вкл/выкл камеру, переключение фронт/задняя камера, экраноподеление (только в индивидуальных звонках).
  - Качество: Адаптивное (360p–1080p в зависимости от соединения), с использованием WebRTC.
- **Общие сценарии**: Уведомление о входящем звонке (push-уведомление). Если пользователь оффлайн — пропущенный звонок в истории. Логика: При звонке устанавливается P2P-соединение через STUN/TURN-сервера (интегрированные в Supabase или внешние как Twilio).

### 3.4. Прочие функции
- **Поиск**:
  - Глобальный: Поиск пользователей по имени/email, чатов по названию, сообщений по ключевым словам (в пределах чата).
  - Сценарий: Ввод запроса в поисковую строку — отображение результатов с подсветкой совпадений.
- **Уведомления**:
  - Push-уведомления: О новых сообщениях, звонках, упоминаниях (используя Firebase Cloud Messaging для Android/iOS).
  - Настройки: Вкл/выкл по типам (сообщения/звонки), mute для конкретных чатов (на 1 час/день/навсегда).
  - Сценарий: При новом сообщении — push с текстом (первые 50 символов) и именем отправителя.
- **Настройки**:
  - Общие: Язык приложения, тема (светлая/темная/системная), автозагрузка медиа.
  - Безопасность: Двухфакторная аутентификация (2FA via SMS/app), блокировка приложения PIN-кодом.
  - Сценарий: Экран настроек с разделами, изменения сохраняются в профиле пользователя в БД.

## 4. Нефункциональные требования

### 4.1. Производительность
- Время отклика: Менее 200 мс на отправку сообщения, менее 500 мс на загрузку списка чатов (при 100 чатах).
- Масштабируемость: Поддержка 10 000 одновременных подключений без деградации (используя авто-масштабирование Supabase).
- Оптимизация: Кэширование сообщений локально (Realm или SQLite), ленивая загрузка медиа.

### 4.2. Безопасность
- Шифрование: End-to-end для сообщений/звонков, HTTPS для всех API-запросов.
- Защита: Защита от SQL-инъекций (RLS в Supabase), JWT-токены для аутентификации, rate-limiting (не более 100 запросов/мин на пользователя).
- Соответствие: GDPR/CCPA для обработки данных, аудит логов на Supabase.

### 4.3. UX/UI
- Дизайн: Материальный дизайн для Android, Cupertino для iOS, с единым стилем (Figma-макеты предоставляются отдельно).
- Доступность: Поддержка screen reader (VoiceOver/TalkBack), контрастность цветов (WCAG 2.1 AA).
- Интуитивность: Минималистичный интерфейс, жесты (свайп для удаления, pull-to-refresh для обновления чатов).

## 5. Интерфейсы и интеграции

### 5.1. Ключевые экраны
- **Экран входа/регистрации**: Поля для email/пароля, кнопки OAuth, ссылка на восстановление.
- **Главный экран**: Список чатов (карточки с аватаром, именем, последним сообщением, временем).
- **Экран чата**: Поле ввода, список сообщений (пузыри слева/справа), кнопки для медиа/звонков.
- **Экран звонка**: Видео-поток(и), кнопки управления (микрофон/камера/завершить).
- **Экран профиля**: Фото, поля редактирования, кнопка "Сохранить".
- **Экран настроек**: Список опций с переключателями/селекторами.

### 5.2. Логика взаимодействия
- Навигация: Bottom Tab Bar (Чаты/Звонки/Настройки/Профиль) + Stack Navigator для модальных экранов.
- Интеграции: 
  - Supabase Auth для входа/регистрации.
  - Supabase Storage для файлов.
  - WebRTC для звонков (с fallback на серверное реле).
  - Push-уведомления через Firebase, интегрированные с Supabase.
- Поток: После входа — загрузка списка чатов из БД. При открытии чата — подписка на Realtime-обновления. Звонок: Инициация через Socket.io, переход к P2P.

